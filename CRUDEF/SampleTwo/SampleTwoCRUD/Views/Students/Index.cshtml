@using SampleCrud.Contracts.Entities
@Html.AntiForgeryToken
@model List<Students>
@{
}
<div class="card">
    <div class="card-header">
        <div class="row">
            <h4 class="col">MY STUDENTS</h4>
            <div class="col">
                @* <button class="btn btn-primary float-end">Add Student</button> *@
                <a asp-action="Add" class="btn btn-primary float-end">Add Student</a>
            </div>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-light table-hover" id="tblStudent">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var dto in Model)
                {
                    <tr>
                        <td>@dto.FirstName @dto.MiddleName @dto.LastName</td>
                        <td>@dto.Email</td>
                        <td>@dto.Phone</td>
                        <td>@dto.Address</td>
                        <td>
                           <form id="optStudent" method="post">
                                <a asp-action="MoveEdit" asp-route-id="@dto.StudentId" class="btn btn-primary">Edit</a>
                                <a src="#" onclick="DeleteSomeStudent(@dto.StudentId)" class="btn btn-danger">Delete</a>
                           </form>

                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
@section Scripts{
    
    <script>
        $(function(){
            console.log('Loaded!');
        });
    </script>

    <script type="text/javascript">

        function DisplaySomeMessage(messageHere)
        {
            Swal.fire({
              icon: "success",
              title: "Success",
              text: messageHere,
              footer: '<a href="#">some foote maybe</a>'
            });
        }

    </script>

    <script type="text/javascript">

        function DeleteSomeStudent(id){
           var token = $('input[name="__RequestVerificationToken"]').val();

           $.ajax({
                url: '@Url.Action("DeleteStudent", "Students")',
                type: 'POST',
                data: { StudentId: id}, 
                headers: {
                    "RequestVerificationToken": token
                },
                success: function (response) {

                    if (response.error == false) {
                        DisplaySomeMessage("Removed the user successfully.");

                        setTimeout(function () {
                            location.reload(); 
                        }, 3000);

                    } else {
                        alert("Validation failed.");
                    }
                },
                error: function () {
                    alert("Error occurred.");
                }
            });

        }

    </script>

}